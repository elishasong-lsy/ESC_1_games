<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESC-1-5 Handwriting Practice</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#f6f7fb; margin:0; padding:24px;}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:14px;}
    .title{font-size:22px; font-weight:900; color:#111827;}
    .btns{display:flex; gap:10px; align-items:center;}
    button{border:0; padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer;}
    .primary{background:#6d28d9; color:#fff;}
    .ghost{background:#fff; color:#111827; border:1px solid #e5e7eb;}
    .score{background:#fff; border:1px solid #e5e7eb; padding:10px 14px; border-radius:12px; font-weight:900;}
    .layout{display:grid; grid-template-columns: 340px 1fr; gap:16px;}
    .card{background:#fff; border:1px solid #e5e7eb; border-radius:18px; padding:16px;}
    .label{font-size:13px; font-weight:900; color:#6b7280; margin-bottom:6px;}
    .big{font-size:28px; font-weight:900; color:#111827;}
    .mid{font-size:18px; font-weight:800; color:#111827;}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;}
    .chip{border:1px solid #e5e7eb; background:#fff; border-radius:999px; padding:8px 10px; font-weight:800; cursor:pointer;}
    .chip:hover{border-color:#6d28d9;}
    .writerWrap{display:flex; flex-direction:column; gap:10px;}
    #writerTarget{width:520px; height:520px; margin:0 auto; background:#fff; border:2px solid #e5e7eb; border-radius:18px;}
    .hint{color:#6b7280; font-weight:700;}
    #statusText{color:#b42318; font-weight:900;}
    @media (max-width: 980px){
      .layout{grid-template-columns:1fr;}
      #writerTarget{width:min(520px, 92vw); height:min(520px, 92vw);}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="title">ESC-1-5 Â· Handwriting Practice</div>
    <div class="btns">
      <div class="score" id="scoreBox">Score: $0</div>
      <button class="ghost" id="speakBtn">ğŸ”Š Speak</button>
      <button class="ghost" id="nextBtn">Next â–¶</button>
      <button class="primary" id="restartBtn">Restart</button>
    </div>
  </div>

  <div class="layout">
    <div class="card">
      <div class="label">Current Item</div>
      <div class="label" style="margin-top:8px;">Word / Phrase</div>
      <div class="big" id="wordBox">ä½ å¥½</div>

      <div class="label" style="margin-top:12px;">Pinyin</div>
      <div class="mid" id="pinyinBox">nÇ hÇo</div>

      <div class="label" style="margin-top:12px;">English</div>
      <div class="mid" id="englishBox">hello</div>

      <div class="chips" id="chips"></div>
      <div class="hint" style="margin-top:12px;">Write in the big box. (We only practice writing strokes here.)</div>
      <div id="statusText"></div>
    </div>

    <div class="card writerWrap">
      <div class="big" id="charTitle">ä½ </div>
      <div class="label" id="charIndex">Character 1 / 2</div>
      <div id="writerTarget" aria-label="handwriting target"></div>
    </div>
  </div>

  <!-- HanziWriter core -->
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.7.0/dist/hanzi-writer.min.js"></script>

  <script>
    // âœ… WL1 + WL2 (ä½ å¯ä»¥ä»¥åè‡ªå·±æ”¹è¿™é‡Œçš„åˆ—è¡¨)
    const VOCAB = [
      // WL1
      { hanzi:"å¥½", pinyin:"hÇo", english:"good / OK" },
      { hanzi:"ä½ å¥½", pinyin:"nÇ hÇo", english:"hello" },
      { hanzi:"å§“", pinyin:"xÃ¬ng", english:"last name" },
      { hanzi:"é©¬", pinyin:"mÇ", english:"(surname) Ma" },
      { hanzi:"å«", pinyin:"jiÃ o", english:"to be called" },
      { hanzi:"ä»€ä¹ˆ", pinyin:"shÃ©n me", english:"what" },
      { hanzi:"å", pinyin:"mÃ­ng", english:"name" },
      { hanzi:"å­—", pinyin:"zÃ¬", english:"character" },
      { hanzi:"ç‹", pinyin:"wÃ¡ng", english:"(surname) Wang" },
      { hanzi:"å†", pinyin:"zÃ i", english:"again" },
      { hanzi:"è§", pinyin:"jiÃ n", english:"see / meet" },
      { hanzi:"å†è§", pinyin:"zÃ i jiÃ n", english:"goodbye" },

      // WL2
      { hanzi:"ä»–", pinyin:"tÄ", english:"he / him" },
      { hanzi:"è°", pinyin:"shÃ©i", english:"who" },
      { hanzi:"ä»Šå¹´", pinyin:"jÄ«n niÃ¡n", english:"this year" },
      { hanzi:"å²", pinyin:"suÃ¬", english:"years old" },
      { hanzi:"å¥¹", pinyin:"tÄ", english:"she / her" },
      { hanzi:"ä¹Ÿ", pinyin:"yÄ›", english:"also" },
      { hanzi:"å¤š", pinyin:"duÅ", english:"many / much" },
      { hanzi:"å¤§", pinyin:"dÃ ", english:"big; (age) old" },
      { hanzi:"å¾ˆ", pinyin:"hÄ›n", english:"very" }
    ];

    let itemIndex = 1; // é»˜è®¤ä»â€œä½ å¥½â€å¼€å§‹
    let charIndex = 0;
    let score = 0;
    let writer = null;

    function uniqueCharsFrom(hanzi){
      // åªç»ƒå­—ï¼šæŠŠè¯æ‹†æˆå•å­—
      return Array.from(hanzi);
    }

    function updateUI(){
      const item = VOCAB[itemIndex];
      document.getElementById("wordBox").textContent = item.hanzi;
      document.getElementById("pinyinBox").textContent = item.pinyin;
      document.getElementById("englishBox").textContent = item.english;

      const chars = uniqueCharsFrom(item.hanzi);
      document.getElementById("charTitle").textContent = chars[charIndex] || "";
      document.getElementById("charIndex").textContent = `Character ${charIndex+1} / ${chars.length}`;

      document.getElementById("scoreBox").textContent = `Score: $${score}`;

      loadCharacter(chars[charIndex]);
    }

    async function loadCharacter(char){
      const status = document.getElementById("statusText");
      status.textContent = "Loading characterâ€¦";

      // æ¸…ç©ºæ—§å†…å®¹
      document.getElementById("writerTarget").innerHTML = "";

      try{
        // âœ… å…³é”®ï¼šæ‰‹åŠ¨æ‹‰å­—åº“æ•°æ®ï¼ˆä¸è®©å®ƒè‡ªå·±çŒœï¼‰
        const url = `https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/${encodeURIComponent(char)}.json`;
        const res = await fetch(url, { cache:"no-store" });
        if(!res.ok) throw new Error("Data fetch failed: " + res.status);
        const charData = await res.json();

        writer = HanziWriter.create("writerTarget", char, {
          width: 520,
          height: 520,
          padding: 20,
          charData,
          showOutline: true,
          showCharacter: true,
          outlineColor: "#d0d5dd",
          strokeColor: "#111827",
          strokeWidth: 7,
          leniency: 1.0
        });

        status.textContent = "";
        writer.quiz({
          onComplete: function(){
            // å†™å®Œä¸€ä¸ªå­—ï¼šåŠ åˆ†å¹¶è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ªå­—/è¯
            score += 100;
            nextCharOrItem();
          }
        });

      }catch(e){
        console.error(e);
        status.textContent = "âš ï¸ å­—åº“åŠ è½½å¤±è´¥ï¼šè¯·ç”¨ Netlify/GitHub Pages æ‰“å¼€ï¼ˆä¸è¦ç”¨æœ¬åœ° file æ‰“å¼€ï¼‰ã€‚æˆ–æ¢ä¸ªç½‘ç»œã€‚";

        // å…œåº•ï¼šè‡³å°‘æ˜¾ç¤ºä¸€ä¸ªæ·¡å­—ï¼Œä¸è¦ç©ºç™½
        document.getElementById("writerTarget").innerHTML =
          `<div style="font-size:220px;font-weight:900;opacity:.15;display:flex;align-items:center;justify-content:center;height:100%;">${char}</div>`;
      }
    }

    function nextCharOrItem(){
      const chars = uniqueCharsFrom(VOCAB[itemIndex].hanzi);
      if(charIndex < chars.length - 1){
        charIndex += 1;
      }else{
        // ä¸‹ä¸€ä¸ªè¯
        itemIndex = (itemIndex + 1) % VOCAB.length;
        charIndex = 0;
      }
      updateUI();
    }

    function restart(){
      score = 0;
      itemIndex = 1;
      charIndex = 0;
      updateUI();
    }

    function speakCurrent(){
      const item = VOCAB[itemIndex];
      const utter = new SpeechSynthesisUtterance(item.hanzi);
      utter.lang = "zh-CN";
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    }

    function renderChips(){
      const chips = document.getElementById("chips");
      chips.innerHTML = "";
      VOCAB.forEach((v, i)=>{
        const b = document.createElement("button");
        b.className = "chip";
        b.textContent = v.hanzi;
        b.onclick = ()=>{ itemIndex = i; charIndex = 0; updateUI(); };
        chips.appendChild(b);
      });
    }

    // Buttons
    document.getElementById("nextBtn").onclick = nextCharOrItem;
    document.getElementById("restartBtn").onclick = restart;
    document.getElementById("speakBtn").onclick = speakCurrent;

    // Init
    renderChips();
    updateUI();
  </script>
</body>
</html>
