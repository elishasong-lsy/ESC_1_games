<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ESC-1-2 æ—¶é—´å•å…ƒï½œå¤§é±¼åƒå°é±¼ v1.6 ç»ˆæç‰ˆ</title>

  <style>
    :root{
      --text:#f4f7ff;
      --muted:#c7d1ff;
      --panel: rgba(15, 23, 42, 0.95);
      --border: rgba(255,255,255,0.2);
      --accent:#ffd54a;
      --good:#63ffb0;
      --bad:#ff5f86;
    }
    *{box-sizing:border-box;}
    html,body{height:100%; margin:0; background: #020617; overflow: hidden;}
    body{
      font-family: system-ui, -apple-system, sans-serif;
      color:var(--text);
      user-select:none;
    }

    #ocean-bg {
      position: fixed; inset: 0;
      background: radial-gradient(circle at 50% 0%, #1e293b, #020617);
      z-index: 1;
    }

    /* HUD é¢æ¿ */
    .hud {
      position: fixed; top: 10px; left: 10px; right: 10px;
      display: flex; gap: 12px; z-index: 100;
    }
    .card {
      background: var(--panel);
      backdrop-filter: blur(15px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 15px 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.6);
    }
    .left { flex: 1; }
    .right { width: 220px; text-align: right; }

    .promptBig { font-size: 36px; font-weight: 900; color: var(--accent); letter-spacing: 1.5px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    .hint { font-size: 14px; color: var(--muted); margin-top: 4px; font-weight: 500; }
    
    /* å¥å­è¿›åº¦æ¡ */
    .progress { display: flex; gap: 6px; margin-top: 12px; flex-wrap: wrap; min-height: 40px; }
    .tok { padding: 5px 12px; border-radius: 10px; background: rgba(0,0,0,0.5); font-size: 20px; border: 1px solid var(--border); transition: all 0.3s; font-weight: bold; }
    .tok.done { color: var(--good); border-color: var(--good); opacity: 0.4; }
    .tok.now { border-color: var(--accent); color: var(--accent); box-shadow: 0 0 20px var(--accent); transform: scale(1.15); }

    .modebar { display: flex; gap: 6px; flex-wrap: wrap; }
    .btn {
      background: rgba(255,255,255,0.08); border: 1px solid var(--border);
      color: white; padding: 7px 14px; border-radius: 10px; font-size: 14px;
      cursor: pointer; font-weight: bold; transition: all 0.2s;
    }
    .btn:hover { background: rgba(255,255,255,0.15); }
    .btn.on { background: var(--accent); color: #000; border-color: var(--accent); box-shadow: 0 0 15px rgba(255,213,74,0.4); }

    /* å·¨å‹å¤§é±¼ */
    #bigFish {
      position: absolute; 
      width: 350px; height: 180px; /* å°ºå¯¸ç¿»å€ */
      left: 50%; top: 65%; transform: translate(-50%, -50%);
      z-index: 50; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      pointer-events: none;
      display: flex; align-items: center; justify-content: center;
    }
    #bigFish .emoji { 
      font-size: 160px; /* è¶…å¤§ Emoji */
      transform: scaleX(-1); 
      filter: drop-shadow(0 20px 35px rgba(0,0,0,0.7)); 
    }

    /* è¿·ä½ å°é±¼ */
    .smallFish {
      position: absolute; width: 80px; height: 50px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 40px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 20; transition: opacity 0.3s, transform 0.2s;
      border: 1px solid rgba(255,255,255,0.25);
    }
    .smallFish:hover { transform: scale(1.15); background: rgba(255, 255, 255, 0.25); }
    
    .smallFish::after {
      content: ''; position: absolute; width: 18px; height: 25px;
      background: inherit; top: 12px; z-index: -1;
      border: inherit;
    }
    .facing-right::after { right: -12px; clip-path: polygon(0% 50%, 100% 0%, 100% 100%); }
    .facing-left::after { left: -12px; clip-path: polygon(100% 50%, 0% 0%, 0% 100%); }

    .smallFish .char { font-size: 20px; font-weight: 900; color: white; text-shadow: 0 2px 5px black; pointer-events: none; }

    .smallFish.good { background: rgba(99, 255, 176, 0.45); border-color: var(--good); }
    .smallFish.bad { background: rgba(255, 95, 134, 0.45); border-color: var(--bad); }

    .overlay { position: fixed; inset: 0; display: none; z-index: 200; background: rgba(0,0,0,0.92); align-items: center; justify-content: center; flex-direction: column; }
  </style>
</head>
<body>

<div id="ocean-bg">
  <div id="bigFish"><span class="emoji">ğŸŸ</span></div>
  <div id="fish-container" style="position: absolute; inset: 0;"></div>
</div>

<div class="hud">
  <div class="card left">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h1 style="font-size: 13px; margin: 0; opacity: 0.6; font-weight: 800;">ESC-1-2 æ—¶é—´å•å…ƒç»ˆææŒ‘æˆ˜ v1.6</h1>
      <div class="modebar">
        <button class="btn on" id="btnWord">è¯è¯­å¯¹æ‹¼éŸ³</button>
        <button class="btn" id="btnChar">å•å­—å¯¹æ‹¼éŸ³</button>
        <button class="btn" id="btnSent">å¥å­(æ‹¼éŸ³)</button>
        <button class="btn" id="btnTranslate">ç¿»è¯‘æŒ‘æˆ˜</button>
      </div>
    </div>
    <div class="prompt" style="margin-top: 10px;">
      <div id="promptBig" class="promptBig">---</div>
      <div id="hint" class="hint">å‡†å¤‡å¼€å§‹...</div>
      <div id="progress" class="progress"></div>
    </div>
  </div>
  <div class="card right">
    <div style="font-size: 22px; font-weight: 900; color: var(--accent);">å¾—åˆ†: <span id="score">0</span></div>
    <div style="font-size: 15px; opacity: 0.8; font-weight: bold;">â¤ï¸ ç”Ÿå‘½: <span id="lives">3</span></div>
    <div style="margin-top: 10px; display: flex; gap: 8px; justify-content: flex-end;">
      <button class="btn" id="btnPause" style="background: rgba(0,0,0,0.4);">æš‚åœ</button>
      <button class="btn" id="btnReset" style="background: rgba(0,0,0,0.4);">é‡ç½®</button>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <h2 id="ovTitle" style="font-size: 56px; color: white; margin-bottom: 35px; text-shadow: 0 5px 15px black;">æ¸¸æˆç»“æŸ</h2>
  <button class="btn" style="padding: 15px 50px; font-size: 24px; background: var(--accent); color: black;" onclick="location.reload()">é‡æ–°æŒ‘æˆ˜</button>
</div>

<script>
// è¯æ±‡åº“
const WORDS = [
  {p:"zÇoshang", zh:"æ—©ä¸Š"}, {p:"shÃ ngwÇ”", zh:"ä¸Šåˆ"}, {p:"zhÅngwÇ”", zh:"ä¸­åˆ"},
  {p:"xiÃ wÇ”", zh:"ä¸‹åˆ"}, {p:"wÇnshang", zh:"æ™šä¸Š"}, {p:"chÃ ", zh:"å·®"},
  {p:"diÇn", zh:"ç‚¹"}, {p:"fÄ“n", zh:"åˆ†"}, {p:"kÃ¨", zh:"åˆ»"}, {p:"bÃ n", zh:"åŠ"}, 
  {p:"liÇng", zh:"ä¸¤"}, {p:"lÃ­ng", zh:"é›¶"}
];

const CHARS = [
  {p:"zÇo", zh:"æ—©"}, {p:"shÃ ng", zh:"ä¸Š"}, {p:"wÇ”", zh:"åˆ"}, {p:"zhÅng", zh:"ä¸­"},
  {p:"xiÃ ", zh:"ä¸‹"}, {p:"wÇn", zh:"æ™š"}, {p:"diÇn", zh:"ç‚¹"}, {p:"fÄ“n", zh:"åˆ†"},
  {p:"lÃ­ng", zh:"é›¶"}, {p:"liÇng", zh:"ä¸¤"}, {p:"kÃ¨", zh:"åˆ»"}, {p:"bÃ n", zh:"åŠ"}, {p:"le", zh:"äº†"}
];

// åŠ å…¥æ›´å¤æ‚çš„å¥å­
const SENTENCES = [
  { p:"xiÃ nzÃ i jÇ diÇn le?", en:"What time is it now?", tokens:["ç°","åœ¨","å‡ ","ç‚¹","äº†","ï¼Ÿ"] },
  { p:"xiÃ nzÃ i liÃ¹ diÇn shÃ­ fÄ“n", en:"It's 6:10", tokens:["ç°","åœ¨","å…­","ç‚¹","å","åˆ†"] },
  { p:"xiÃ nzÃ i bÄ diÇn lÃ­ng wÇ” fÄ“n", en:"It's 8:05", tokens:["ç°","åœ¨","å…«","ç‚¹","é›¶","äº”","åˆ†"] },
  { p:"xiÃ nzÃ i jiÇ” diÇn yÃ­ kÃ¨", en:"It's 9:15", tokens:["ç°","åœ¨","ä¹","ç‚¹","ä¸€","åˆ»"] },
  { p:"xiÃ nzÃ i shÃ­ yÄ« diÇn bÃ n", en:"It's 11:30", tokens:["ç°","åœ¨","å","ä¸€","ç‚¹","åŠ"] },
  { p:"xiÃ nzÃ i chÃ  shÃ­ fÄ“n bÄ diÇn", en:"It's 10 to 8", tokens:["ç°","åœ¨","å·®","å","åˆ†","å…«","ç‚¹"] },
  // å¤æ‚å¥å­
  { p:"xiÃ nzÃ i wÇnshang shÃ­yÄ« diÇn sÄn kÃ¨", en:"It's 11:45 PM", tokens:["ç°","åœ¨","æ™š","ä¸Š","å","ä¸€","ç‚¹","ä¸‰","åˆ»"] },
  { p:"xiÃ nzÃ i zÇoshang wÇ” diÇn lÃ­ng wÇ” fÄ“n", en:"It's 5:05 AM", tokens:["ç°","åœ¨","æ—©","ä¸Š","äº”","ç‚¹","é›¶","äº”","åˆ†"] },
  { p:"xiÃ nzÃ i zhÅngwÇ” shÃ­Ã¨r diÇn bÃ n", en:"It's 12:30 PM", tokens:["ç°","åœ¨","ä¸­","åˆ","å","äºŒ","ç‚¹","åŠ"] },
  { p:"xiÃ nzÃ i xiÃ wÇ” liÇng diÇn yÃ­ kÃ¨", en:"It's 2:15 PM", tokens:["ç°","åœ¨","ä¸‹","åˆ","ä¸¤","ç‚¹","ä¸€","åˆ»"] }
];

const POOL = ["ç°","åœ¨","æ—©","ä¸Š","ä¸­","ä¸‹","æ™š","åˆ","ç‚¹","åˆ†","å","äº”","å…«","ä¸€","åˆ»","ä¸¤","å·®","é›¶","äº†","å‡ ","å…­","ä¸‰","äºŒ","ï¼Ÿ"];

let score=0, lives=3, mode="word", running=true, paused=false, fishEls=[], target=null, sentence=null, sIndex=0;

function updateHUD() {
  document.getElementById("score").innerText = score;
  document.getElementById("lives").innerText = lives;
}

function spawnFish(label) {
  const el = document.createElement("div");
  el.className = "smallFish";
  el.innerHTML = `<span class="char">${label}</span>`;
  
  // ä¸¥æ ¼é™åˆ¶ y åæ ‡åœ¨å±å¹• 250px ä»¥ä¸‹æ¸¸åŠ¨ï¼Œä¸é®æŒ¡æ–‡å­—åŒº
  const x = Math.random() * (window.innerWidth - 200) + 100;
  const y = Math.random() * (window.innerHeight - 380) + 260; 
  
  el.style.left = x + "px";
  el.style.top = y + "px";
  
  const vx = (Math.random() - 0.5) * 120;
  const vy = (Math.random() - 0.5) * 80;
  
  if(vx > 0) el.classList.add('facing-left'); else el.classList.add('facing-right');

  const obj = { el, label, x, y, vx, vy, alive: true };
  el.onclick = (e) => { e.stopPropagation(); eatFish(obj); };
  document.getElementById("fish-container").appendChild(el);
  fishEls.push(obj);
}

function newRound() {
  fishEls.forEach(f => f.el.remove()); fishEls = [];
  document.getElementById("progress").innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å¥å­è¿›åº¦

  if (mode === "word") {
    target = WORDS[Math.floor(Math.random() * WORDS.length)];
    document.getElementById("promptBig").innerText = target.p; // åªæ˜¾ç¤ºæ‹¼éŸ³
    document.getElementById("hint").innerText = "æ‰¾å‡ºæ­£ç¡®çš„æ±‰å­—è¯è¯­å°é±¼";
    const distract = WORDS.filter(w => w.zh !== target.zh).sort(() => 0.5 - Math.random()).slice(0, 5).map(w => w.zh);
    [target.zh, ...distract].sort(() => 0.5 - Math.random()).forEach(spawnFish);
  } else if (mode === "char") {
    target = CHARS[Math.floor(Math.random() * CHARS.length)];
    document.getElementById("promptBig").innerText = target.p; // åªæ˜¾ç¤ºæ‹¼éŸ³
    document.getElementById("hint").innerText = "æ‰¾å‡ºå¯¹åº”æ‹¼éŸ³çš„å•å­—å°é±¼";
    const distract = CHARS.filter(c => c.zh !== target.zh).sort(() => 0.5 - Math.random()).slice(0, 5).map(c => c.zh);
    [target.zh, ...distract].sort(() => 0.5 - Math.random()).forEach(spawnFish);
  } else if (mode === "sent") {
    sentence = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
    sIndex = 0;
    document.getElementById("promptBig").innerText = sentence.p;
    document.getElementById("hint").innerText = "æŒ‰ç…§æ‹¼éŸ³é¡ºåºåƒæ‰æ­£ç¡®çš„å­—";
    renderSentProgress();
    spawnSentFish();
  } else if (mode === "translate") {
    sentence = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
    sIndex = 0;
    document.getElementById("promptBig").innerText = sentence.en; // ç¿»è¯‘æ¨¡å¼æ˜¾ç¤ºè‹±æ–‡
    document.getElementById("hint").innerText = "ç¿»è¯‘è¯¥æ—¶é—´ï¼ŒæŒ‰é¡ºåºåƒé±¼";
    renderSentProgress();
    spawnSentFish();
  }
}

function spawnSentFish() {
  fishEls.forEach(f => f.el.remove()); fishEls = [];
  const need = sentence.tokens[sIndex];
  const distract = POOL.filter(p => p !== need).sort(() => 0.5 - Math.random()).slice(0, 5);
  [need, ...distract].sort(() => 0.5 - Math.random()).forEach(spawnFish);
}

function renderSentProgress() {
  const box = document.getElementById("progress"); box.innerHTML = "";
  sentence.tokens.forEach((t, i) => {
    const s = document.createElement("span"); 
    s.className = "tok" + (i < sIndex ? " done" : "") + (i === sIndex ? " now" : "");
    s.innerText = t; box.appendChild(s);
  });
}

function eatFish(fish) {
  if (!running || paused || !fish.alive) return;
  const isSentMode = (mode === "sent" || mode === "translate");
  const correct = isSentMode ? sentence.tokens[sIndex] : target.zh;
  const big = document.getElementById("bigFish");
  
  // å¤§é±¼æ‰‘å‘å°é±¼
  big.style.left = fish.x + "px";
  big.style.top = fish.y + "px";
  big.style.transform = `translate(-50%, -50%) scale(1.1)`;

  if (fish.label === correct) {
    fish.alive = false; fish.el.classList.add("good");
    score += 10; updateHUD();
    setTimeout(() => {
      fish.el.style.opacity = "0";
      big.style.transform = `translate(-50%, -50%) scale(1)`;
      if (isSentMode) {
        sIndex++; 
        if (sIndex >= sentence.tokens.length) { score += 50; newRound(); }
        else { renderSentProgress(); spawnSentFish(); }
      } else { newRound(); }
    }, 400);
  } else {
    fish.el.classList.add("bad"); lives--; updateHUD();
    if (lives <= 0) { running = false; document.getElementById("overlay").style.display = "flex"; }
    setTimeout(() => {
      big.style.left = "50%"; big.style.top = "65%";
      big.style.transform = `translate(-50%, -50%)`;
      fish.el.classList.remove("bad");
    }, 500);
  }
}

function tick() {
  if (running && !paused) {
    fishEls.forEach(f => {
      if (!f.alive) return;
      f.x += f.vx * 0.016; f.y += f.vy * 0.016;
      if (f.x < 50 || f.x > window.innerWidth - 120) { 
        f.vx *= -1; 
        f.el.classList.toggle('facing-left'); f.el.classList.toggle('facing-right'); 
      }
      // ä¸Šè¾¹ç•Œä¿æŠ¤ï¼š250px å¤„åå¼¹
      if (f.y < 250 || f.y > window.innerHeight - 80) f.vy *= -1;
      f.el.style.left = f.x + "px"; f.el.style.top = f.y + "px";
    });
  }
  requestAnimationFrame(tick);
}

document.getElementById("btnWord").onclick = () => { mode = "word"; switchBtn("btnWord"); newRound(); };
document.getElementById("btnChar").onclick = () => { mode = "char"; switchBtn("btnChar"); newRound(); };
document.getElementById("btnSent").onclick = () => { mode = "sent"; switchBtn("btnSent"); newRound(); };
document.getElementById("btnTranslate").onclick = () => { mode = "translate"; switchBtn("btnTranslate"); newRound(); };

function switchBtn(id) {
  document.querySelectorAll(".modebar .btn").forEach(b => b.classList.remove("on"));
  document.getElementById(id).classList.add("on");
}
document.getElementById("btnPause").onclick = () => { paused = !paused; document.getElementById("btnPause").innerText = paused ? "ç»§ç»­" : "æš‚åœ"; };
document.getElementById("btnReset").onclick = () => location.reload();

updateHUD(); newRound(); tick();
</script>
</body>
</html>
