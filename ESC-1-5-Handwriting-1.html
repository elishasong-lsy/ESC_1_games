<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ESC-1-5 Handwriting (Clean)</title>

  <!-- HanziWriter -->
  <script src="https://unpkg.com/hanzi-writer@3.7.2/dist/hanziwriter.min.js"></script>

  <style>
    :root{
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #101828;
      --muted: #667085;
      --border: #e4e7ec;
      --accent: #7c3aed;
      --shadow: 0 6px 20px rgba(16,24,40,.08);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 14px 30px;
    }

    /* Header */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:4px;
      min-width: 220px;
    }
    .title .unit{
      font-size:13px;
      color: var(--muted);
      letter-spacing:.2px;
    }
    .title .big{
      font-size:20px;
      font-weight:800;
    }
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    button{
      border:1px solid var(--border);
      background: var(--card);
      color: var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow: 0 2px 10px rgba(16,24,40,.04);
      font-weight:650;
    }
    button:hover{ border-color:#d0d5dd; }
    button.primary{
      background: var(--accent);
      border-color: var(--accent);
      color:#fff;
    }
    .pill{
      border:1px solid var(--border);
      background: var(--card);
      padding:10px 12px;
      border-radius:12px;
      color: var(--muted);
      font-weight:650;
      box-shadow: 0 2px 10px rgba(16,24,40,.04);
    }

    /* Main layout */
    .grid{
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns:1fr; }
    }
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      padding:14px;
    }

    /* Left info */
    .info h2{
      margin:0 0 10px;
      font-size:16px;
      font-weight:800;
    }
    .kv{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    .row{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:10px;
      border:1px solid var(--border);
      border-radius:14px;
      background:#fcfcfd;
    }
    .label{
      font-size:12px;
      color: var(--muted);
      font-weight:700;
      letter-spacing:.2px;
    }
    .value{
      font-size:18px;
      font-weight:850;
    }
    .value.small{
      font-size:16px;
      font-weight:750;
      color: var(--text);
    }
    .progress{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .chip{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      color: var(--muted);
      font-weight:750;
      font-size:12px;
    }

    /* Writer */
    .writerHeader{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:10px;
    }
    .prompt{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .prompt .hanzi{
      font-size:28px;
      font-weight:900;
      letter-spacing:.4px;
      line-height:1.1;
    }
    .prompt .sub{
      color: var(--muted);
      font-weight:700;
      font-size:13px;
    }

    .writerBox{
      display:flex;
      justify-content:center;
      align-items:center;
      padding:14px;
    }

    /* Big writing square */
    #writerTarget{
      width: 420px;
      height: 420px;
      background:#fff;
      border: 2px solid var(--border);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(16,24,40,.08);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }

    /* Subtle grid */
    #writerTarget::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(#f2f4f7 2px, transparent 2px) 0 0 / 50% 50%,
        linear-gradient(90deg, #f2f4f7 2px, transparent 2px) 0 0 / 50% 50%;
      opacity:.35;
      pointer-events:none;
    }

    /* HanziWriter injects SVG; keep it above grid */
    #writerTarget svg{
      position:relative;
      z-index:2;
    }

    .hintLine{
      margin-top:10px;
      color: var(--muted);
      font-size:13px;
      font-weight:650;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">
        <div class="unit">ESC-1-5 Â· Handwriting Practice</div>
        <div class="big">Write the character (æŒ‰ç¬”é¡ºå†™å­—)</div>
      </div>

      <div class="controls">
        <span class="pill" id="scorePill">Score: $0</span>
        <button id="speakBtn">ðŸ”Š Speak</button>
        <button id="skipBtn">Next â–¶</button>
        <button class="primary" id="restartBtn">Restart</button>
      </div>
    </div>

    <div class="grid">
      <!-- Left info card -->
      <div class="card info">
        <h2>Current Item</h2>

        <div class="kv">
          <div class="row">
            <div class="label">Word / Phrase</div>
            <div class="value" id="wordText">â€”</div>
          </div>

          <div class="row">
            <div class="label">Pinyin</div>
            <div class="value small" id="pinyinText">â€”</div>
          </div>

          <div class="row">
            <div class="label">English</div>
            <div class="value small" id="englishText">â€”</div>
          </div>
        </div>

        <div class="progress" id="progressChips"></div>
        <div class="hintLine">Tip: write in the big box. Correct strokes reveal automatically.</div>
      </div>

      <!-- Writer card -->
      <div class="card">
        <div class="writerHeader">
          <div class="prompt">
            <div class="hanzi" id="charPrompt">â€”</div>
            <div class="sub" id="charSub">Character 1 / 1</div>
          </div>
        </div>

        <div class="writerBox">
          <div id="writerTarget" aria-label="handwriting target"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  /***********************
   * 1) VOCAB DATA
   *    ä½ è¦æ¢è¯åº“ï¼šåªåŠ¨è¿™é‡Œ
   ***********************/
  const VOCAB = [
    // WL1 (ç¤ºä¾‹ï¼šä½ å¯ä»¥æŒ‰éœ€è¦å¢žåˆ )
    { word: "å¥½", pinyin: "hÇŽo", english: "good" },
    { word: "ä½ å¥½", pinyin: "nÇ hÇŽo", english: "hello" },
    { word: "å§“", pinyin: "xÃ¬ng", english: "last name; surname" },
    { word: "å«", pinyin: "jiÃ o", english: "to be called" },
    { word: "ä»€ä¹ˆ", pinyin: "shÃ©nme", english: "what" },
    { word: "å", pinyin: "mÃ­ng", english: "given name" },
    { word: "å­—", pinyin: "zÃ¬", english: "character; name" },
    { word: "çŽ‹", pinyin: "wÃ¡ng", english: "Wang (surname)" },
    { word: "é©¬", pinyin: "mÇŽ", english: "Ma (surname)" },
    { word: "å†", pinyin: "zÃ i", english: "again" },
    { word: "è§", pinyin: "jiÃ n", english: "see; meet" },
    { word: "å†è§", pinyin: "zÃ ijiÃ n", english: "goodbye" },

    // WL2
    { word: "ä»–", pinyin: "tÄ", english: "he; him" },
    { word: "è°", pinyin: "shÃ©i", english: "who" },
    { word: "ä»Šå¹´", pinyin: "jÄ«nniÃ¡n", english: "this year" },
    { word: "å²", pinyin: "suÃ¬", english: "years old" },
    { word: "å¥¹", pinyin: "tÄ", english: "she; her" },
    { word: "ä¹Ÿ", pinyin: "yÄ›", english: "also" },
    { word: "å¤š", pinyin: "duÅ", english: "many; much" },
    { word: "å¤§", pinyin: "dÃ ", english: "big; (age) old" },
    { word: "å¾ˆ", pinyin: "hÄ›n", english: "very" }
  ];

  /***********************
   * 2) STATE
   ***********************/
  let itemIndex = 0;
  let charIndex = 0;
  let score = 0;
  let writer = null;

  const $ = (id) => document.getElementById(id);
  const scorePill = $("scorePill");
  const wordText = $("wordText");
  const pinyinText = $("pinyinText");
  const englishText = $("englishText");
  const charPrompt = $("charPrompt");
  const charSub = $("charSub");
  const progressChips = $("progressChips");

  function updateScore(delta){
    score += delta;
    scorePill.textContent = `Score: $${score}`;
  }

  function speakChinese(text){
    // Simple browser TTS (works on most devices; iPad usually ok)
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "zh-CN";
      u.rate = 0.9;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }catch(e){
      // ignore
    }
  }

  /***********************
   * 3) HELPERS
   ***********************/
  function currentItem(){
    return VOCAB[itemIndex];
  }

  function currentChar(){
    const w = currentItem().word;
    return w[charIndex]; // handles multi-character word
  }

  function renderProgress(){
    progressChips.innerHTML = "";
    VOCAB.forEach((v, idx) => {
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.textContent = idx === itemIndex ? `â–¶ ${v.word}` : v.word;
      progressChips.appendChild(chip);
    });
  }

  function renderInfo(){
    const item = currentItem();
    wordText.textContent = item.word;
    pinyinText.textContent = item.pinyin;
    englishText.textContent = item.english;

    const w = item.word;
    charPrompt.textContent = currentChar();
    charSub.textContent = `Character ${charIndex + 1} / ${w.length}`;
    renderProgress();
  }

  /***********************
   * 4) HANZI WRITER SETUP
   *    å…³é”®ï¼šç™½åº• + æµ…ç°æçº¢ + å†™å¯¹åŽç¬”ç”»åŠ æ·±æ˜¾ç¤º
   ***********************/
  async function loadCharacter(char){
    // Clean old SVG if any
    $("writerTarget").innerHTML = "";

    // Create writer
    writer = HanziWriter.create("writerTarget", char, {
      width: 420,
      height: 420,
      padding: 18,

      // This makes the faint "ghost" character underneath
      showOutline: true,
      showCharacter: true,

      // colors (high contrast, not dark background)
      outlineColor: "#d0d5dd",     // faint gray outline
      strokeColor: "#111827",      // dark strokes when revealed
      radicalColor: "#111827",

      // keep it responsive for slower kids
      strokeWidth: 6,

      // Make it forgiving
      leniency: 1.0
    });

    // Start quiz mode: correct strokes reveal; wrong strokes donâ€™t pass
    startQuiz();
  }

  function startQuiz(){
    if(!writer) return;

    // quiz() returns a Promise that resolves when full character completed correctly
    writer.quiz({
      // visually nicer
      showHintAfterMisses: 9999,   // basically never auto-hint
      highlightOnComplete: false
    }).then(() => {
      // Character finished correctly
      updateScore(100);
      goNextCharOrItem();
    });
  }

  function goNextCharOrItem(){
    const w = currentItem().word;
    if(charIndex < w.length - 1){
      charIndex += 1;
      renderInfo();
      loadCharacter(currentChar());
      return;
    }
    // move to next vocab item
    itemIndex = (itemIndex + 1) % VOCAB.length;
    charIndex = 0;
    renderInfo();
    loadCharacter(currentChar());
  }

  function restartAll(){
    itemIndex = 0;
    charIndex = 0;
    score = 0;
    scorePill.textContent = "Score: $0";
    renderInfo();
    loadCharacter(currentChar());
  }

  /***********************
   * 5) EVENTS
   ***********************/
  $("speakBtn").addEventListener("click", () => {
    speakChinese(currentItem().word);
  });

  $("skipBtn").addEventListener("click", () => {
    goNextCharOrItem();
  });

  $("restartBtn").addEventListener("click", () => {
    restartAll();
  });

  // Keyboard shortcuts
  window.addEventListener("keydown", (e) => {
    if(e.key === "Enter") speakChinese(currentItem().word);
    if(e.key === "ArrowRight") goNextCharOrItem();
    if(e.key.toLowerCase() === "r") restartAll();
  });

  /***********************
   * 6) INIT
   ***********************/
  renderInfo();
  loadCharacter(currentChar());
</script>
</body>
</html>
