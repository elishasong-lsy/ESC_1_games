<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESC-1-5 Handwriting Practice (WL1+WL2)</title>

  <!-- HanziWriter (CDN) -->
  <script src="https://unpkg.com/hanzi-writer@3.7.0/dist/hanziwriter.min.js"></script>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#111a2e;
      --panel2:#0f1729;
      --text:#e9eefc;
      --muted:#aab6df;
      --accent:#7aa2ff;
      --good:#3ddc97;
      --bad:#ff6b6b;
      --line:#223055;
      --card:#0e1730;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 30% 0%, #152145 0%, var(--bg) 55%, #070b14 100%);
      color:var(--text);
    }
    header{
      padding:16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(10,16,30,.55);
      backdrop-filter: blur(10px);
      position:sticky;
      top:0;
      z-index:10;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .title h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
    }
    .title .sub{
      color:var(--muted);
      font-size:12px;
    }
    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      font-size:12px;
      color:var(--muted);
    }
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding:6px 10px;
      border-radius:999px;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .pill b{color:var(--text); font-weight:700}

    main{
      display:grid;
      grid-template-columns: 330px 1fr 330px;
      gap:14px;
      padding:14px;
      max-width: 1280px;
      margin:0 auto;
    }
    @media (max-width: 1100px){
      main{grid-template-columns: 1fr; }
    }

    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .panel h2{
      margin:0 0 10px;
      font-size:14px;
      color:var(--muted);
      letter-spacing:.6px;
      text-transform:uppercase;
    }

    .big{
      font-size:40px;
      font-weight:800;
      margin:0;
      line-height:1.1;
      letter-spacing:.5px;
    }
    .pinyin{
      margin-top:6px;
      color:var(--accent);
      font-weight:700;
      font-size:18px;
    }
    .english{
      margin-top:6px;
      color:var(--muted);
      font-size:14px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    button{
      appearance:none;
      border:none;
      cursor:pointer;
      color:var(--text);
      background: rgba(122,162,255,.18);
      border:1px solid rgba(122,162,255,.35);
      padding:10px 12px;
      border-radius:12px;
      font-weight:700;
      letter-spacing:.2px;
      transition: transform .05s ease, background .2s ease;
      user-select:none;
    }
    button:hover{background: rgba(122,162,255,.26)}
    button:active{transform: translateY(1px)}
    button.secondary{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
    }
    button.danger{
      background: rgba(255,107,107,.15);
      border:1px solid rgba(255,107,107,.35);
    }
    .note{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
    }

    /* Center writer area */
    .writerWrap{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      justify-content:center;
      min-height: 520px;
      background: radial-gradient(900px 540px at 50% 20%, rgba(122,162,255,.12), rgba(0,0,0,0));
    }
    .targetLine{
      width:100%;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:flex-end;
    }
    .targetLine .left{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .term{
      font-size:18px;
      color:var(--muted);
    }
    .term b{color:var(--text)}
    .charFocus{
      font-size:46px;
      font-weight:900;
      letter-spacing:1px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
    }

    #writerBox{
      width: 360px;
      height: 360px;
      border-radius:18px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 18px 50px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .gridLine{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.25;
      background:
        linear-gradient(to right, transparent 49.7%, rgba(255,255,255,.12) 50%, transparent 50.3%),
        linear-gradient(to bottom, transparent 49.7%, rgba(255,255,255,.12) 50%, transparent 50.3%),
        linear-gradient(to right, rgba(255,255,255,.06) 0, rgba(255,255,255,.06) 1px, transparent 1px, transparent 100%),
        linear-gradient(to bottom, rgba(255,255,255,.06) 0, rgba(255,255,255,.06) 1px, transparent 1px, transparent 100%);
      background-size: 100% 100%, 100% 100%, 25% 25%, 25% 25%;
    }

    .feedback{
      width:100%;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:2px;
      font-size:13px;
    }
    .tag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color:var(--muted);
    }
    .tag.good{border-color: rgba(61,220,151,.35); background: rgba(61,220,151,.10); color: #c8ffe9;}
    .tag.bad{border-color: rgba(255,107,107,.35); background: rgba(255,107,107,.10); color: #ffe1e1;}

    .list{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .chip{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }
    .chip:hover{border-color: rgba(122,162,255,.45); color: var(--text)}
    .chip.active{
      border-color: rgba(122,162,255,.55);
      background: rgba(122,162,255,.14);
      color: var(--text);
    }

    .small{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      line-height:1.5;
    }
    .divider{
      height:1px;
      background: rgba(255,255,255,.08);
      margin:12px 0;
    }
  </style>
</head>

<body>
  <header>
    <div class="title">
      <h1>ESC-1-5 âœï¸ Handwriting Practice</h1>
      <div class="sub">WL1 + WL2 â€¢ stroke-order required â€¢ tap â€œHearâ€ for audio</div>
    </div>
    <div class="stats">
      <div class="pill">Score <b id="score">0</b></div>
      <div class="pill">Item <b id="idx">1</b>/<b id="total">0</b></div>
      <div class="pill">Char <b id="charIdx">1</b>/<b id="charTotal">1</b></div>
    </div>
  </header>

  <main>
    <!-- LEFT: Prompt / controls -->
    <section class="panel">
      <h2>Prompt</h2>
      <div class="big" id="promptText">â€”</div>
      <div class="pinyin" id="promptPinyin"> </div>
      <div class="english" id="promptEnglish"> </div>

      <div class="row">
        <button id="hearBtn">ğŸ”Š Hear</button>
        <button id="hintBtn" class="secondary">ğŸ‘€ Show Outline</button>
        <button id="replayBtn" class="secondary">â†º Replay Demo</button>
      </div>

      <div class="row">
        <button id="resetCharBtn" class="danger">Reset Char</button>
        <button id="nextBtn">Next âœ</button>
      </div>

      <div class="note">
        âœ… å¿…é¡»æŒ‰ç¬”é¡ºå†™ã€‚å†™å¯¹ä¼šè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ªå­—ï¼ˆè¯è¯­ä¼šé€å­—ç»ƒï¼‰ã€‚<br/>
        å°è´´å£«ï¼šå¦‚æœå­¦ç”Ÿå¡ä½ï¼Œç‚¹ â€œReplay Demoâ€ çœ‹ä¸€éåŠ¨ç”»ï¼Œå†å†™ã€‚
      </div>

      <div class="divider"></div>

      <h2>Quick Pick</h2>
      <div class="small">ç‚¹è¯æ¡å¯ç›´æ¥è·³åˆ°è¯¥è¯ï¼ˆæ–¹ä¾¿ä½ è¯¾å ‚æŒ‰éœ€ç»ƒï¼‰</div>
      <div class="list" id="vocabChips"></div>
    </section>

    <!-- CENTER: Writer -->
    <section class="panel writerWrap">
      <div class="targetLine">
        <div class="left">
          <div class="term" id="termLine">Term: <b>â€”</b></div>
          <div class="charFocus" id="charFocus">â€”</div>
          <div class="hint" id="charHint">Write this character in the box (stroke order required).</div>
        </div>
        <div class="right">
          <div class="tag" id="modeTag">Mode: Stroke Quiz</div>
        </div>
      </div>

      <div id="writerBox">
        <div class="gridLine"></div>
        <div id="writerTarget" style="width:100%; height:100%;"></div>
      </div>

      <div class="feedback">
        <span class="tag" id="fbTag">Ready</span>
      </div>
    </section>

    <!-- RIGHT: Info -->
    <section class="panel">
      <h2>Info</h2>
      <div class="small">
        <b>Goal:</b> write the highlighted character correctly (order matters).<br/>
        <b>Scoring:</b> correct char +100, reset -10 (you can change in code).<br/>
        <b>Audio:</b> uses browser voice (Chinese). If no sound, try Chrome + unmute.
      </div>

      <div class="divider"></div>

      <h2>Teacher Notes</h2>
      <div class="small">
        - è¯è¯­ï¼ˆå¦‚â€œå†è§â€â€œä½ å¥½â€â€œåå­—â€ï¼‰ä¼šæ‹†æˆå•å­—ç»ƒï¼šå†â†’è§ã€‚<br/>
        - æƒ³åªç»ƒå•å­—ï¼šæŠŠ VOCAB é‡Œå¤šå­—è¯åˆ æ‰å³å¯ã€‚<br/>
        - æƒ³æ¢æˆä½ è‡ªå·±çš„è¯åº“ï¼šåªæ”¹ <code>VOCAB</code> æ•°ç»„ã€‚
      </div>

      <div class="divider"></div>

      <h2>Keyboard</h2>
      <div class="small">
        Space: Hear â€¢ N: Next â€¢ R: Reset Char
      </div>
    </section>
  </main>

<script>
  /***************
   * VOCAB (edit here)
   * tip: multi-character terms will be practiced one char at a time.
   ***************/
  const VOCAB = [
    // WL1
    { term:"ä½ å¥½", pinyin:"nÇ hÇo", english:"hello" },
    { term:"å¥½", pinyin:"hÇo", english:"good / well" },
    { term:"å§“", pinyin:"xÃ¬ng", english:"last name / surname" },
    { term:"é©¬", pinyin:"mÇ", english:"(surname) Ma" },
    { term:"ç‹", pinyin:"wÃ¡ng", english:"(surname) Wang" },
    { term:"å«", pinyin:"jiÃ o", english:"to be called" },
    { term:"ä»€ä¹ˆ", pinyin:"shÃ©nme", english:"what" },
    { term:"å", pinyin:"mÃ­ng", english:"name (given name)" },
    { term:"å­—", pinyin:"zÃ¬", english:"character / name" },
    { term:"åå­—", pinyin:"mÃ­ngzi", english:"name" },
    { term:"å†", pinyin:"zÃ i", english:"again" },
    { term:"è§", pinyin:"jiÃ n", english:"see / meet" },
    { term:"å†è§", pinyin:"zÃ ijiÃ n", english:"goodbye" },

    // WL2
    { term:"ä»–", pinyin:"tÄ", english:"he / him" },
    { term:"è°", pinyin:"shÃ©i", english:"who" },
    { term:"ä»Šå¹´", pinyin:"jÄ«nniÃ¡n", english:"this year" },
    { term:"å²", pinyin:"suÃ¬", english:"years old" },
    { term:"å¥¹", pinyin:"tÄ", english:"she / her" },
    { term:"ä¹Ÿ", pinyin:"yÄ›", english:"also" },
    { term:"å¤š", pinyin:"duÅ", english:"many / much" },
    { term:"å¤§", pinyin:"dÃ ", english:"big / (age) old" },
    { term:"å¾ˆ", pinyin:"hÄ›n", english:"very" },
    { term:"å¾ˆå¤š", pinyin:"hÄ›n duÅ", english:"a lot / many" }
  ];

  // --- Simple TTS (browser speech) ---
  function speakChinese(text){
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "zh-CN";
      u.rate = 0.95;
      u.pitch = 1.0;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }catch(e){
      // no-op
    }
  }

  // --- State ---
  let currentIndex = 0;
  let charIndex = 0;
  let score = 0;
  let writer = null;
  let quiz = null;

  // UI refs
  const scoreEl = document.getElementById("score");
  const idxEl = document.getElementById("idx");
  const totalEl = document.getElementById("total");
  const charIdxEl = document.getElementById("charIdx");
  const charTotalEl = document.getElementById("charTotal");

  const promptTextEl = document.getElementById("promptText");
  const promptPinyinEl = document.getElementById("promptPinyin");
  const promptEnglishEl = document.getElementById("promptEnglish");

  const termLineEl = document.getElementById("termLine");
  const charFocusEl = document.getElementById("charFocus");
  const fbTagEl = document.getElementById("fbTag");

  const vocabChipsEl = document.getElementById("vocabChips");

  totalEl.textContent = VOCAB.length;

  // Build chips
  VOCAB.forEach((v, i) => {
    const chip = document.createElement("div");
    chip.className = "chip";
    chip.textContent = `${v.term} (${v.pinyin})`;
    chip.addEventListener("click", () => {
      currentIndex = i;
      charIndex = 0;
      loadItem();
    });
    vocabChipsEl.appendChild(chip);
  });

  function setActiveChip(){
    [...vocabChipsEl.children].forEach((c, i) => {
      c.classList.toggle("active", i === currentIndex);
    });
  }

  function getCurrent(){
    return VOCAB[currentIndex];
  }

  function getCurrentChar(){
    const t = getCurrent().term;
    return t[charIndex];
  }

  function updateHeader(){
    scoreEl.textContent = score;
    idxEl.textContent = currentIndex + 1;

    const term = getCurrent().term;
    charIdxEl.textContent = charIndex + 1;
    charTotalEl.textContent = term.length;
  }

  function setFeedback(type, text){
    fbTagEl.className = "tag";
    if(type === "good") fbTagEl.classList.add("good");
    if(type === "bad") fbTagEl.classList.add("bad");
    fbTagEl.textContent = text;
  }

  // Create writer for a single character
  function mountWriter(char){
    const target = document.getElementById("writerTarget");
    target.innerHTML = "";

    writer = HanziWriter.create("writerTarget", char, {
      width: 360,
      height: 360,
      padding: 18,
      showOutline: false,
      showCharacter: true,
      strokeAnimationSpeed: 1,
      delayBetweenStrokes: 120,
      strokeColor: "#7aa2ff",
      radicalColor: "#ff6b6b",
      outlineColor: "rgba(233,238,252,.15)",
      drawingColor: "#e9eefc",
      highlightColor: "#3ddc97",
      charDataLoader: HanziWriter.loadCharacterData
    });

    // quiz enforces stroke order
    quiz = writer.quiz({
      onMistake: function(strokeData){
        setFeedback("bad", "Not quiteâ€”watch the order ğŸ‘€");
      },
      onCorrectStroke: function(){
        setFeedback("good", "Good stroke âœ…");
      },
      onComplete: function(){
        score += 100;
        setFeedback("good", "+100 âœ… Completed!");
        updateHeader();
        // move to next char or next item automatically after a short pause
        setTimeout(() => {
          advanceCharOrItem();
        }, 450);
      }
    });
  }

  function loadItem(){
    const v = getCurrent();
    setActiveChip();

    // Left prompt
    promptTextEl.textContent = v.term;
    promptPinyinEl.textContent = v.pinyin || "";
    promptEnglishEl.textContent = v.english || "";

    // Center focus
    termLineEl.innerHTML = `Term: <b>${v.term}</b>  â€¢  Pinyin: <b>${v.pinyin}</b>`;
    charFocusEl.textContent = getCurrentChar();

    setFeedback("", "Ready");
    updateHeader();
    mountWriter(getCurrentChar());
  }

  function advanceCharOrItem(){
    const termLen = getCurrent().term.length;
    if(charIndex < termLen - 1){
      charIndex += 1;
      charFocusEl.textContent = getCurrentChar();
      setFeedback("", "Next char â†’");
      updateHeader();
      mountWriter(getCurrentChar());
    }else{
      // next item
      currentIndex = (currentIndex + 1) % VOCAB.length;
      charIndex = 0;
      loadItem();
    }
  }

  function nextItem(){
    currentIndex = (currentIndex + 1) % VOCAB.length;
    charIndex = 0;
    loadItem();
  }

  function resetChar(){
    score = Math.max(0, score - 10);
    updateHeader();
    setFeedback("bad", "-10 Reset");
    mountWriter(getCurrentChar());
  }

  // Buttons
  document.getElementById("hearBtn").addEventListener("click", () => {
    speakChinese(getCurrent().term);
  });

  document.getElementById("hintBtn").addEventListener("click", async () => {
    if(!writer) return;
    writer.showOutline(true);
    setFeedback("", "Outline shown");
    setTimeout(() => writer.showOutline(false), 1200);
  });

  document.getElementById("replayBtn").addEventListener("click", async () => {
    if(!writer) return;
    setFeedback("", "Demo playingâ€¦");
    writer.animateCharacter();
  });

  document.getElementById("resetCharBtn").addEventListener("click", resetChar);
  document.getElementById("nextBtn").addEventListener("click", nextItem);

  // Keyboard shortcuts
  window.addEventListener("keydown", (e) => {
    if(e.code === "Space"){ e.preventDefault(); speakChinese(getCurrent().term); }
    if(e.key.toLowerCase() === "n"){ nextItem(); }
    if(e.key.toLowerCase() === "r"){ resetChar(); }
  });

  // Start
  loadItem();
</script>
</body>
</html>
